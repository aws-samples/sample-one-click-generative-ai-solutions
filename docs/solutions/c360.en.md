# Customer 360 Text2SQL Segmentation & Entity Resolution

[Customer 360 Text2SQL Segmentation & Entity Resolution](https://github.com/aws-samples/sample-c360-text2sql-segmentation-entityresolution) provides a comprehensive platform for customer data integration, segmentation, and natural language database querying capabilities. Leveraging AWS Entity Resolution and Amazon Personalize, this solution helps organizations consolidate scattered customer data to build a 360-degree customer view and gain valuable business insights.

## Key Features

- **Entity Resolution**: Customer data integration using AWS Entity Resolution
- **Text2SQL**: Natural language database querying functionality powered by Amazon Bedrock
- **Customer Segmentation**: Advanced customer segmentation using Amazon Personalize
- **Web Interface**: Intuitive web UI for operations and data visualization
- **Real-time Processing**: Efficient data processing workflows using Step Functions
- **Scalable Design**: Auto-scaling through serverless architecture

## Primary Use Cases

- **Customer Data Integration**: Consolidate customer information scattered across multiple systems
- **Customer Segmentation**: Create precise segments based on integrated customer data
- **Data Analysis Democratization**: Enable non-technical users to perform data analysis through natural language queries
- **Marketing Optimization**: Leverage unified customer views for targeted marketing campaigns

## Deploy to AWS

Click the button below to deploy. Please log in to AWS first.

<div class="solution-card__actions">
  <div class="solution-card__deployment">
    <select class="region-selector">
      <option value="us-east-1">Virginia</option>
      <option value="ap-northeast-1">Tokyo</option>
      <option value="us-west-2">Oregon</option>
    </select>
    <a href="https://us-east-1.console.aws.amazon.com/cloudformation/home#/stacks/create/review?stackName=C360DeploymentStack&templateURL=https://aws-ml-jp.s3.ap-northeast-1.amazonaws.com/asset-deployments/C360DeploymentStack.yaml" class="deployment-button md-button" target="_blank">
      <i class="fa-solid fa-rocket"></i>ã€€Deploy
    </a>
  </div>
</div>

### Parameter Configuration

You can configure the following parameters during deployment:

* **NotificationEmailAddress**: Email address for deployment start and completion notifications
* **EntityResolutionEnabled**: Enable AWS Entity Resolution functionality (default: false)
* **PersonalizeEnabled**: Enable Amazon Personalize functionality (default: false, only available when EntityResolution is true)

### Post-Deployment Setup

After clicking the deploy button, you will receive an `AWS Notification - Subscription Confirmation` email shortly. Click the `Confirm subscription` link to receive deployment start and completion notifications.

Upon deployment completion, you will receive a notification email with the following information:

1. **Frontend URL**: URL to access the application
2. **Amazon Bedrock Model Access Setup**: Instructions for enabling access to models required for Text2SQL functionality
3. **Data Upload Instructions**: How to upload CSV files
4. **Configuration Information**: Confirmation of parameters specified during deployment

### Resource Cleanup

To delete deployed resources, remove the following stacks from the CloudFormation console:

1. C360 main stack
2. `C360DeploymentStack` deployment stack

!!! warning "Warning"
    Stack deletion will remove all integrated customer data and segmentation results. Export necessary data beforehand.

## Usage

### Test Data Preparation

1. **Generate Test Data**

Execute the script as follows to create test CSV files:

```bash
python dbloader/gen_testdata.py
```

2. **Edit Test Data Upload Script**

Open `dbloader/upload_to_s3.py` in a text editor and set the S3_BUCKET_NAME variable to the bucket name noted during deployment

3. **Upload Test Data**

Execute the upload:

```bash 
python dbloader/upload_to_s3.py
```

4. **Execute Data Integration Workflow**

Run the data integration workflow using AWS Entity Resolution / Amazon Personalize.
Open the [AWS Step Functions Management Console](https://ap-northeast-1.console.aws.amazon.com/states/home?region=ap-northeast-1#/statemachines) and execute the StateMachine that starts with `DataIntegrationWorkflow`

### User Creation

Create users in Amazon Cognito User Pool.
Create users from the [Management Console](https://ap-northeast-1.console.aws.amazon.com/cognito/v2/idp/user-pools?region=ap-northeast-1).

This completes the setup.
Access the URL noted during deployment (`AmtC360MarketingStack.WebAppUrl`) from your browser
